## Redis在实践过程中需要考虑的问题以及解决方案

* 数据本身就没有 - 数据本身在后端数据库中就没有，自然在redis中也没有，每次查询该数据时都不可能在redis中找到，这样所有的查询都会进入后端数据库查询，这样就会造成数据库的压力。

	* 将所有存在的数据缓存在布隆过滤器中，每次查询之前先在布隆过滤器中判断数据是否存在

	* 将不存在的数据按照特定的格式缓存在redis中，客户端从redis读取该数据后要根据格式判断数据是否存在

* 大量的key同时过期 - 大量的key同时过期会导致后端数据库压力瞬间增大

	* 对于key的过期时间可以增加一个随机数保证key的过期时间不一致

* 热点数据key过期 - 热点数据在redis中过期也会瞬间导致后端数据库压力增大
	* 设置标志位和延长过期时间确保只有一个进程会向后端数据库请求数据，其他进程使用过期的数据

* 数据预热


| client A | client B |
| -------- | -------- |
| # 设置缓存数据<br/>127.0.0.1:6379> set foo bar<br/>OK | |
| # 设置过期时间<br/>127.0.0.1:6379> EXPIRE foo 200<br/>(integer) 1 | |
| # 设置更新标志位<br/>127.0.0.1:6379> set flag 0<br/>OK | |
| | |
|  # 查询过期时间<br/>127.0.0.1:6379> TTL foo<br/>(integer) 187 | # 查询过期时间<br/>127.0.0.1:6379> TTL foo<br/>(integer) 187 |
| # 没有过期之前可以正常访问数据
127.0.0.1:6379> get foo
"bar"   | # 没有过期之前可以正常访问数据
127.0.0.1:6379> get foo
"bar"   |
|                                                              |                                                              |
| # 其中一个进程在过期时间小于50的时候就要去后端更新数据
127.0.0.1:6379> TTL foo
(integer) 50 | # 其中一个进程在过期时间小于50的时候就要去后端更新数据
127.0.0.1:6379> TTL foo
(integer) 50 |
| # 查看是否有其他进程已经去后端更新数据
127.0.0.1:6379> get flag
"0" | # 查看是否有其他进程已经去后端更新数据
127.0.0.1:6379> get flag
"1" |
| # 标识已经有进程去后端更新数据了
127.0.0.1:6379> INCR flag
(integer) 1 | # 继续使用即将过期的数据
127.0.0.1:6379> get foo
"bar"         |
| # 重新设置过期时间，保证其他进程可以读取过期数据
127.0.0.1:6379> EXPIRE foo 200
(integer) 1 |                                                              |
| # 后端数据库获取数据                                         |                                                              |
| # 设置最新的缓存数据
127.0.0.1:6379> set foo bar
OK            |                                                              |
| # 设置过期时间
127.0.0.1:6379> EXPIRE foo 200
(integer) 1      |                                                              |
| # 恢复标志位
127.0.0.1:6379> INCRBY flag -1
(integer) 0        |                                                              |
|                                                              |                                                              |
| # 正常访问数据
127.0.0.1:6379> get foo
"bar"                   | # 正常访问数据
127.0.0.1:6379> get foo
"bar"                   |