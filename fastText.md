## fastText

- [安装 fastText](#安装-fasttext)

- [word vectors](#word-vectors)

- [text classification](#text-classification)

#### 安装 fastText

```bash
# 安装 fasttext 到当前目录
$ wget https://github.com/facebookresearch/fastText/archive/v0.1.0.zip
$ unzip v0.1.0.zip
$ cd fastText-0.1.0
$ make

# fasttext 命令帮助
$ ./fasttext
usage: fasttext <command> <args>

The commands supported by fasttext are:

  supervised              train a supervised classifier(训练有监督的分类器)
  quantize                quantize a model to reduce the memory usage(量化模型以减少内存使用量)
  test                    evaluate a supervised classifier
  predict                 predict most likely labels(预测最可能的标签)
  predict-prob            predict most likely labels with probabilities(用可能性预测最可能的标签)
  skipgram                train a skipgram model(训练一个skipgram模型)
  cbow                    train a cbow model(训练一个cbow模型)
  print-word-vectors      print word vectors given a trained model
  print-sentence-vectors  print sentence vectors given a trained model
  nn                      query for nearest neighbors(查询最近邻居)
  analogies               query for analogies(查询类比)

```

#### word vectors

```bash
# 下载示例数据
$ mkdir data
$ wget -c http://mattmahoney.net/dc/enwik9.zip -P data
$ unzip data/enwik9.zip -d data
$ ll data/
total 1291612
drwxrwxr-x 2 lanzhiwang lanzhiwang       4096 10月 16 10:31 ./
drwxrwxr-x 5 lanzhiwang lanzhiwang       4096 10月 15 20:53 ../
-rw-rw-r-- 1 lanzhiwang lanzhiwang 1000000000 6月   1  2011 enwik9
-rw-rw-r-- 1 lanzhiwang lanzhiwang  322592222 9月   2  2011 enwik9.zip
# 观察下载的原始数据
$ head -n 20 data/enwik9
<mediawiki xmlns="http://www.mediawiki.org/xml/export-0.3/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mediawiki.org/xml/export-0.3/ http://www.mediawiki.org/xml/export-0.3.xsd" version="0.3" xml:lang="en">
  <siteinfo>
    <sitename>Wikipedia</sitename>
    <base>http://en.wikipedia.org/wiki/Main_Page</base>
    <generator>MediaWiki 1.6alpha</generator>
    <case>first-letter</case>
      <namespaces>
      <namespace key="-2">Media</namespace>
      <namespace key="-1">Special</namespace>
      <namespace key="0" />
      <namespace key="1">Talk</namespace>
      <namespace key="2">User</namespace>
      <namespace key="3">User talk</namespace>
      <namespace key="4">Wikipedia</namespace>
      <namespace key="5">Wikipedia talk</namespace>
      <namespace key="6">Image</namespace>
      <namespace key="7">Image talk</namespace>
      <namespace key="8">MediaWiki</namespace>
      <namespace key="9">MediaWiki talk</namespace>
      <namespace key="10">Template</namespace>
# 预处理数据
$ perl data/wikifil.pl data/enwik9 > data/fil9
$ ll data/
total 1987984
drwxrwxr-x 2 lanzhiwang lanzhiwang       4096 10月 16 10:47 ./
drwxrwxr-x 6 lanzhiwang lanzhiwang       4096 10月 16 10:44 ../
-rw-rw-r-- 1 lanzhiwang lanzhiwang 1000000000 6月   1  2011 enwik9
-rw-rw-r-- 1 lanzhiwang lanzhiwang  322592222 9月   2  2011 enwik9.zip
-rw-rw-r-- 1 lanzhiwang lanzhiwang  713069767 10月 16 10:49 fil9
-rw-rw-r-- 1 lanzhiwang lanzhiwang       1995 10月 16 10:47 wikifil.pl
# 观察处理之后的数据
$ head -c 80 data/fil9
 anarchism originated as a term of abuse first used against early working class
# 训练词向量
$ mkdir result
$ ./fastText-0.1.0/fasttext skipgram -input data/fil9 -output result/fil9
Read 124M words
Number of words:  218316
Number of labels: 0
Progress: 100.0%  words/sec/thread: 72274  lr: 0.000000  loss: 0.679654  eta: 0h0m
$
lanzhiwang@lanzhiwang-desktop:~/work/fastText$ ll result
total 1141652
drwxrwxr-x 2 lanzhiwang lanzhiwang      4096 10月 16 13:19 ./
drwxrwxr-x 7 lanzhiwang lanzhiwang      4096 10月 16 10:52 ../
-rw-rw-r-- 1 lanzhiwang lanzhiwang 978480868 10月 16 13:19 fil9.bin
-rw-rw-r-- 1 lanzhiwang lanzhiwang 190554445 10月 16 13:19 fil9.vec
# 查看最终的词向量
$ head -n 10 result/fil9.vec
218316 100
the 0.14098 -0.17995 -0.052553 0.45431 0.34108 0.13617 -0.21093 0.05291 0.34754 -0.2216 -0.21318 0.033724 -0.29213 0.25233 -0.27512 -0.028003 -0.081625 -0.029651 0.01266 -0.47598 0.19883 0.34531 0.032197 -0.11209 0.069588 0.26188 -0.045297 0.00677 -0.10393 -0.11177 -0.081246 0.083624 0.10142 -0.23635 -0.13502 -0.048187 0.025962 0.0038029 0.084657 -0.20336 0.056455 -0.19633 -0.049041 0.3473 0.37145 -0.033159 0.21982 -0.082497 -0.093405 -0.018083 0.020407 -0.070366 -0.05653 -0.16766 0.072769 -0.25697 0.016506 -0.025657 0.34974 0.2396 0.11595 0.043141 -0.031293 -0.22033 0.091656 0.10918 -0.12835 -0.23918 -0.33705 -0.34971 0.14345 0.061234 -0.10316 -0.10094 -0.029822 -0.11192 0.11982 0.078272 0.175 0.080929 -0.033516 0.091153 0.22393 0.25862 -0.2896 0.12393 0.074492 0.16885 -0.27959 -0.087446 0.37871 -0.059665 0.0001098 -0.27406 -0.069973 -0.021699 0.14246 -0.14867 0.057608 0.092286 
of 0.14576 -0.088488 -0.13786 0.53738 0.33487 0.17856 -0.081262 0.18625 0.27008 -0.082008 -0.25323 0.059931 -0.27144 0.36874 -0.24753 -0.094664 -0.053324 -0.16496 0.098892 -0.39941 -0.041097 0.44661 0.046996 0.077965 0.096747 0.37952 -0.037725 -0.054717 -0.22937 -0.15452 0.015931 0.14736 -0.026555 -0.19528 -0.11791 -0.041758 -0.012169 0.023919 0.10864 -0.32093 0.086547 -0.22097 -0.091322 0.30541 0.45333 -0.084045 0.039319 -0.0833 -0.12521 -0.17763 -0.055327 -0.19643 -0.28951 -0.29286 0.042189 -0.30209 0.03454 0.12832 0.40288 0.27347 0.14538 0.087003 -0.094206 -0.232 0.044185 0.096959 -0.068933 -0.23426 -0.10527 -0.38681 0.043435 0.090159 0.0016589 0.11699 -0.14747 -0.065086 0.15989 -0.044824 0.31084 0.1022 -0.018848 -0.068503 0.089216 0.391 -0.24341 0.058195 0.084315 0.19448 -0.26664 -0.095686 0.32391 -0.23813 -0.098314 -0.28511 -0.049422 0.013816 0.15886 -0.29184 0.18861 0.0095747 
one 0.53756 -0.20359 -0.38711 0.48184 0.31712 0.26595 -0.17107 0.37205 0.06204 -0.2962 -0.40395 0.12381 -0.054396 0.076442 -0.039464 0.1442 0.030814 -0.16362 0.11427 -0.48541 0.080211 0.22358 -0.11742 0.23679 0.11849 0.2327 -0.18534 0.20235 -0.34753 0.084306 -0.32752 0.059773 0.076267 -0.42207 0.13191 -0.22155 -0.43134 0.016356 0.15657 -0.26807 0.26375 -0.071154 0.028353 0.039076 0.43912 -0.060503 0.35237 -0.034924 0.00062944 0.0030723 -0.080076 0.11839 -0.16901 -0.465 0.014022 -0.23022 -0.2614 -0.002996 0.31773 0.13791 0.1084 -0.083214 0.028163 0.0076959 0.0044531 0.28146 0.033744 -0.21844 -0.26931 -0.3112 0.029901 0.29259 -0.35153 -0.10293 -0.065549 0.238 0.2748 0.19965 0.64385 -0.098422 -0.055707 0.13897 0.26339 0.23531 -0.24364 -0.12852 0.16185 0.16306 -0.25643 0.10951 0.22001 0.012575 -0.2731 -0.58934 -0.3226 -0.055286 0.33549 -0.29436 0.37886 0.27634 
zero 0.57259 -0.25399 -0.086979 0.43052 0.26805 0.32036 -0.16544 0.36895 -0.11822 -0.3127 -0.51956 0.26637 -0.12135 -0.0044659 -0.099629 0.1752 -0.030086 -0.074839 0.18347 -0.56106 0.04799 0.20609 -0.20536 0.28192 0.29048 0.090423 -0.18022 0.3444 -0.27438 0.029315 -0.60749 -0.074921 0.082512 -0.4229 0.18823 -0.24865 -0.47151 -0.024732 0.14693 -0.34618 0.1157 -0.10851 -0.14601 0.022587 0.41288 -0.14778 0.18982 0.083545 0.098395 -0.0049229 -0.050017 0.10258 -0.15928 -0.48573 -0.057118 -0.13005 -0.35769 -0.12381 0.34113 0.19475 0.067863 0.06347 0.20507 -0.16075 0.061203 0.48392 0.2192 -0.19168 -0.18227 -0.38344 -0.021382 0.24746 -0.19404 -0.15709 -0.10167 0.32235 0.2556 0.24307 0.54976 -0.14716 -0.25352 0.22693 0.31782 0.45659 -0.40498 -0.20458 0.099928 0.097853 -0.25941 0.25338 0.16636 -0.15032 -0.29291 -0.60096 -0.45229 -0.14673 0.30502 -0.29859 0.21286 0.25335 
and 0.13673 -0.022302 -0.32604 0.28695 0.23314 0.14663 -0.12633 -0.039881 0.077232 -0.18509 -0.15971 -0.019515 -0.064062 0.24019 -0.18662 0.099677 -0.031903 -0.17232 -0.029108 -0.43981 -0.03139 0.26124 0.036527 0.040407 -0.080284 0.14768 -0.096751 -0.037632 -0.18009 -0.10687 -0.12247 0.10246 -0.22339 -0.06159 -0.20382 -0.069069 -0.0017799 0.0088647 0.18388 -0.019578 0.1487 -0.16087 -0.18105 0.27969 0.43676 -0.15995 0.20933 -0.047832 -0.23459 0.040145 -0.046622 -0.017872 -0.18041 -0.20234 -0.055284 -0.08144 -0.083368 0.060771 0.36515 0.16448 0.24689 0.084217 -0.018355 -0.14603 0.11539 0.10108 -0.045764 -0.044247 -0.17132 -0.42422 0.019507 0.20731 -0.14812 0.13987 -0.11606 -0.065608 0.16606 0.12724 0.24371 0.012566 -0.024281 0.051935 0.15146 0.40724 -0.27035 -0.079062 0.017559 0.36257 -0.28055 -0.14706 0.30792 -0.16127 0.015675 -0.26117 -0.18539 -0.088594 0.10816 -0.30191 0.1173 -0.016333 
in 0.28778 -0.17304 -0.088862 0.35728 0.33242 -0.041344 -0.26391 0.052432 0.28805 -0.25589 -0.2282 -0.045471 -0.23596 0.22441 -0.24713 -0.014993 -0.057067 -0.02476 0.13148 -0.59117 0.05702 0.16477 -0.060187 -0.016361 0.01899 0.30924 -0.049611 0.017921 -0.16203 -0.073894 -0.10158 0.059698 0.038311 -0.17517 -0.17215 -0.16275 0.18962 -0.021337 -0.049645 -0.12979 0.019265 -0.22015 -0.21836 0.20902 0.40662 0.11596 0.12627 -0.085622 -0.093247 0.061418 0.019402 0.014166 -0.16458 -0.13105 0.04029 -0.17632 -0.10634 0.051135 0.183 0.14181 0.3342 -0.10423 0.043921 -0.20444 0.064351 0.087696 -0.31777 0.051491 -0.20231 -0.45128 0.15955 -0.0073878 -0.26434 0.13605 -0.14418 -0.11728 0.19558 0.17734 0.17604 0.12283 -0.0081867 0.064755 0.17876 0.20081 -0.11646 0.094677 0.24944 0.056898 -0.19206 -0.062501 0.48912 -0.11735 0.0084542 -0.28051 -0.052112 -0.021746 0.096981 -0.24301 -0.032493 0.077325 
two 0.51837 -0.25611 -0.23241 0.35795 0.25675 0.30966 -0.22254 0.42309 -0.055689 -0.27155 -0.41708 0.20105 -0.14908 0.0062568 -0.077359 0.14557 0.021354 -0.094771 0.17365 -0.52236 0.02618 0.25663 -0.22006 0.27539 0.22095 0.13916 -0.23901 0.26298 -0.25855 -0.10055 -0.55951 0.045336 0.081025 -0.47041 0.13418 -0.22535 -0.42908 0.11974 0.19771 -0.39672 0.2316 -0.10718 -0.11456 0.031406 0.39763 -0.16372 0.45895 -0.044297 0.082639 -0.040411 -0.17209 0.01917 -0.27499 -0.44519 0.0081263 -0.24234 -0.35577 0.074264 0.33758 0.1836 0.050394 -0.0013463 0.14384 -0.053976 0.08281 0.31628 0.15707 -0.26251 -0.18575 -0.27752 0.03865 0.21746 -0.27163 -0.12549 -0.043802 0.24239 0.27365 0.30022 0.63588 -0.10593 -0.15032 0.21971 0.31856 0.33758 -0.40713 -0.13067 0.24257 0.19691 -0.22599 0.27258 0.14315 -0.12458 -0.20565 -0.62821 -0.31312 -0.072636 0.40797 -0.29227 0.40011 0.18613 
a 0.060104 -0.1674 0.11262 0.15864 0.3529 0.019485 -0.046582 0.11687 0.34342 -0.26978 -0.15453 -0.097491 -0.22698 0.22777 -0.17276 0.11605 -0.055512 -0.15187 0.073785 -0.30963 0.060038 -0.055795 -0.07924 -0.10937 0.32613 0.17242 -0.025812 -0.070376 -0.25504 -0.13723 -0.059883 -0.34198 -0.10474 -0.26156 -0.12142 -0.14189 -0.23992 0.21884 0.12299 -0.089986 -0.064632 -0.15091 -0.28374 0.091558 0.46464 0.08822 0.16937 0.009235 -0.058433 -0.22721 0.0095256 0.027982 -0.08183 -0.33938 0.13225 -0.15755 0.12791 0.12345 0.36089 0.16471 0.15525 -0.07649 0.044092 -0.45139 -0.10856 0.1105 -0.39655 0.081841 -0.45009 -0.29562 0.054414 -0.16993 -0.21827 -0.022823 -0.14598 0.0073424 0.21078 0.18439 0.36674 0.0016249 -0.0042536 0.014538 0.15983 0.051138 -0.30287 0.03892 -0.060385 0.252 -0.04505 -0.18042 0.48894 -0.060094 0.14827 -0.15651 -0.030768 0.071861 0.058555 -0.2696 0.18486 0.013694 
nine 0.52075 -0.20453 -0.2491 0.49588 0.27999 0.1526 -0.38112 0.38572 0.032773 -0.23655 -0.40337 0.11757 0.032314 -0.023927 -0.07466 0.14567 -0.063578 -0.12211 0.099531 -0.57174 0.055429 0.14431 -0.17147 0.37123 0.013688 0.12999 -0.10383 0.16132 -0.26235 0.21455 -0.38044 -0.044175 0.2064 -0.29075 0.15832 -0.19479 -0.42931 -0.00699 0.092656 -0.19366 0.34937 -0.04305 0.0019581 0.066779 0.36246 -0.085194 0.20927 -0.015272 0.020452 0.0095387 0.034463 0.057141 -0.12378 -0.44124 0.034358 -0.15408 -0.22145 0.011017 0.39336 0.021373 0.16631 -0.1596 0.17374 -0.054332 0.067046 0.29694 -0.010142 -0.33346 -0.29739 -0.3595 0.12301 0.22224 -0.42783 -0.035678 0.15761 0.1875 0.33846 0.27934 0.67135 -0.063708 -0.20788 0.23096 0.35525 0.18636 -0.26133 -0.086732 0.1322 0.093719 -0.34582 -0.0090371 0.2527 0.061026 -0.24068 -0.54908 -0.3583 -0.11327 0.37232 -0.38779 0.27892 0.38526 
$ 


```

#### text classification

```bash
# 下载、解压数据
$ wget https://s3-us-west-1.amazonaws.com/fasttext-vectors/cooking.stackexchange.tar.gz
$ tar -zxvf cooking.stackexchange.tar.gz
cooking.stackexchange.id
cooking.stackexchange.txt
readme.txt
# 观察数据结构
$ head cooking.stackexchange.txt
__label__sauce __label__cheese How much does potato starch affect a cheese sauce recipe?
__label__food-safety __label__acidity Dangerous pathogens capable of growing in acidic environments
__label__cast-iron __label__stove How do I cover up the white spots on my cast iron stove?
__label__restaurant Michelin Three Star Restaurant; but if the chef is not there
__label__knife-skills __label__dicing Without knife skills, how can I quickly and accurately dice vegetables?
__label__storage-method __label__equipment __label__bread What's the purpose of a bread box?
__label__baking __label__food-safety __label__substitutions __label__peanuts how to seperate peanut oil from roasted peanuts at home?
__label__chocolate American equivalent for British chocolate terms
__label__baking __label__oven __label__convection Fan bake vs bake
__label__sauce __label__storage-lifetime __label__acidity __label__mayonnaise Regulation and balancing of readymade packed mayonnaise and other sauces
# 统计数据行数
$ wc cooking.stackexchange.txt
  15404  169582 1401900 cooking.stackexchange.txt
# 生成测试数据和验证数据
$ head -n 12404 cooking.stackexchange.txt > cooking.train
$ tail -n 3000 cooking.stackexchange.txt > cooking.valid
# 训练有监督分类器
$ ./fastText-0.1.0/fasttext supervised -input cooking.train -output model_cooking
Read 0M words
Number of words:  14543
Number of labels: 735
Progress: 100.0%  words/sec/thread: 50001  lr: 0.000000  loss: 10.196953  eta: 0h0m
$ ll model_cooking.*
-rw-rw-r-- 1 lanzhiwang lanzhiwang  6382062 10月 15 19:44 model_cooking.bin
-rw-rw-r-- 1 lanzhiwang lanzhiwang 15192790 10月 15 19:44 model_cooking.vec
# 观察生成的模型数据
$ head model_cooking.vec
8952 100
</s> -0.051781 0.62322 -0.20288 -0.45736 1.0866 0.53574 -0.20942 -0.091897 0.53042 0.63385 -0.45265 -0.069507 0.34263 0.40421 -0.56093 -0.4126 0.037524 0.30031 0.056086 -0.23286 -0.16891 0.85476 0.51955 -0.24759 -0.35314 -0.60521 0.2873 -0.36957 -0.37097 0.6936 -0.45391 0.15398 -0.42174 -0.67834 -0.93513 -0.18704 -0.23858 -0.42602 -0.1175 -0.29394 -0.13424 0.90837 0.2615 0.41218 0.43978 -0.41218 0.59362 -0.049813 -0.49046 0.70237 -0.99802 0.57068 -0.40941 0.51691 -0.39807 -0.063679 -0.32419 0.122 0.56814 0.10414 -0.31524 0.56766 0.9633 0.80041 -0.37121 -0.017415 -0.85688 0.28416 -0.13068 0.1913 -0.52062 0.48711 0.15549 -0.38085 -0.58549 -0.40145 0.57208 0.81847 0.4589 -0.16484 -0.04697 0.45571 0.89437 -0.19772 0.11445 -0.21438 -0.034031 0.25134 -0.53548 -0.29207 0.84412 0.16756 1.31 -0.57298 0.065293 -0.77687 0.054794 0.60824 -0.76423 -0.6316 
? -0.075313 0.24837 -0.054487 -0.17283 0.41413 0.2592 -0.070549 -0.070781 0.14581 0.2288 -0.2077 -0.1595 0.070007 0.11422 -0.27063 -0.15797 0.025981 0.14237 -0.018736 -0.054767 -0.10124 0.35352 0.1735 -0.060163 -0.10464 -0.22447 0.080529 -0.14676 -0.14078 0.23914 -0.18396 0.024129 -0.12656 -0.32594 -0.371 -0.079512 -0.12534 -0.11066 -0.050672 -0.13812 -0.092372 0.35751 0.062879 0.21971 0.17491 -0.16877 0.22604 -0.039978 -0.18723 0.23938 -0.3256 0.24039 -0.11418 0.20015 -0.1675 0.00085956 -0.18342 0.04192 0.19833 0.046177 -0.13989 0.22319 0.33034 0.33892 -0.16499 -0.053289 -0.32301 0.079415 -0.11107 0.045283 -0.22847 0.21376 0.053244 -0.15867 -0.25029 -0.12419 0.19182 0.27215 0.19283 0.011744 -0.032081 0.15472 0.34547 0.010328 0.021176 -0.042694 -0.045515 0.11753 -0.17036 -0.099654 0.33984 0.090067 0.48929 -0.20993 0.016937 -0.22582 0.045305 0.24182 -0.28573 -0.2953 
to 0.052944 0.26475 0.03278 -0.20207 0.40533 0.25291 -0.10781 -0.073069 0.30548 0.35099 -0.23869 0.087206 0.040268 0.22067 -0.21851 -0.099227 0.048032 0.16514 -0.082617 -0.19807 0.023609 0.32707 0.17294 -0.13206 -0.1348 -0.21226 0.10793 -0.28885 -0.14792 0.26745 -0.16535 0.076721 -0.20597 -0.24157 -0.46264 -0.024549 -0.14283 -0.17376 -0.013558 -0.017134 -0.054475 0.49525 0.1585 0.27138 0.23564 -0.12293 0.24388 -0.080856 -0.19464 0.3161 -0.41939 0.20084 -0.28974 0.20063 -0.1925 -0.0042906 -0.12387 0.059805 0.23424 0.11034 -0.10604 0.24258 0.45323 0.3468 -0.054812 0.020255 -0.35011 0.057056 0.023319 0.027352 -0.24355 0.16078 0.05134 -0.071492 -0.20266 -0.08822 0.32397 0.24725 0.25109 -0.11581 -0.041246 0.064979 0.32879 -0.15386 0.097006 -0.13119 0.048104 0.074494 -0.2263 -0.019596 0.32164 0.15471 0.55911 -0.25831 0.11311 -0.30737 -0.061932 0.27609 -0.25187 -0.24102 
a 0.013332 0.37589 -0.077255 -0.049105 0.28919 0.2438 -0.10329 -0.06633 0.31471 0.19934 -0.20629 0.13267 0.026729 0.25137 -0.13399 -0.26215 -0.12572 0.017105 0.065533 -0.016514 -0.015865 0.26912 0.33081 -0.16717 -0.22554 -0.18093 0.19797 -0.15906 -0.22682 0.18193 -0.082225 -0.014611 -0.093359 -0.16461 -0.30592 0.078891 -0.024714 -0.13772 -0.10425 -0.18354 -0.073022 0.3677 -0.02976 0.060798 0.28959 -0.12004 0.20801 0.028142 -0.13384 0.127 -0.43437 0.077075 -0.11925 0.09622 -0.070176 -0.065125 -0.08626 0.18213 0.26699 0.0098644 -0.22168 0.16518 0.42241 0.19555 -0.12799 0.11489 -0.36086 -0.0015708 -0.030491 0.029893 -0.019756 0.19859 0.13464 -0.15835 -0.036921 0.057078 0.26669 0.33488 0.15347 -0.23271 -0.0014356 0.14754 0.38901 -0.22083 0.16208 -0.13551 -0.072328 0.16045 -0.26321 -0.12487 0.32299 0.093136 0.40287 -0.24119 -0.069612 -0.26579 0.023676 0.15757 -0.25035 -0.19196 
how -0.0053177 0.028003 0.086168 -0.025764 0.059323 0.041671 0.025142 -0.082072 0.049973 0.11397 -0.059357 -0.046722 -0.036095 -0.035889 -0.028466 0.041965 0.046806 0.097705 -0.054956 -0.012454 0.0047621 0.019891 -0.04025 -0.021604 0.013019 0.021452 0.029727 -0.11562 0.036518 0.081366 -0.057126 0.0037808 -0.092466 -0.025426 -0.065086 0.026064 -0.13422 -0.015764 0.033781 0.051404 -0.052094 0.11643 0.076132 0.092067 -0.0066024 -0.055846 0.072441 -0.032789 0.0019434 0.024927 -0.060278 0.11687 -0.073479 0.027225 -0.09157 0.085695 -0.052797 0.027613 -0.026865 0.077278 -0.04543 0.027224 -0.001989 0.050721 0.039433 -0.0047795 -0.046224 -0.0093601 0.015661 -0.024902 -0.13466 0.023518 0.014343 0.024574 -0.060587 -0.0084032 0.048637 -0.040184 0.079164 0.019713 0.0044486 -0.076213 0.026853 0.037158 -0.032611 -0.0050174 0.021014 0.050374 -0.0032019 0.04555 0.069988 0.065594 0.082835 -0.045955 0.10988 0.074663 -0.020609 0.020189 -0.062227 -0.048799 
the 0.04746 0.24929 0.034422 -0.23703 0.46494 0.28492 -0.12582 -0.022647 0.23763 0.36046 -0.22112 0.031847 0.034228 0.20298 -0.27608 -0.068479 0.085223 0.17032 -0.060393 -0.23147 -0.0098238 0.38589 0.14887 -0.12198 -0.12606 -0.17769 0.058521 -0.28982 -0.11534 0.27154 -0.21246 0.10697 -0.21684 -0.28677 -0.46704 -0.025624 -0.1551 -0.20118 -0.030522 0.016584 -0.047502 0.49253 0.15846 0.31026 0.19741 -0.13524 0.257 -0.13948 -0.22889 0.40096 -0.41269 0.21012 -0.3192 0.24789 -0.20505 0.00064452 -0.15716 0.050903 0.25179 0.13864 -0.13785 0.23926 0.44394 0.39559 -0.04413 -0.03906 -0.357 0.07843 -0.008996 0.052583 -0.31907 0.14438 0.03441 -0.067542 -0.26656 -0.13592 0.27668 0.25773 0.26301 -0.036839 -0.059545 0.088591 0.34878 -0.063733 0.087642 -0.074091 0.0187 0.094872 -0.24115 -0.023062 0.33003 0.14507 0.56481 -0.2486 0.095261 -0.31278 -0.083839 0.3115 -0.28609 -0.32295 
i 0.0060682 0.34818 -0.049398 -0.13804 0.30103 0.27866 -0.082142 -0.043085 0.27975 0.17466 -0.18988 0.12419 0.014173 0.30258 -0.18093 -0.16421 -0.016453 0.029284 -0.045405 -0.13291 0.013132 0.2948 0.3078 -0.14263 -0.11053 -0.26778 0.1147 -0.1672 -0.18518 0.2048 -0.097095 -0.079357 -0.093342 -0.25096 -0.40213 0.0041721 0.010041 -0.083614 -0.090151 -0.14685 -0.0066316 0.39426 0.053022 0.19511 0.3428 -0.032636 0.12793 -0.020592 -0.24218 0.1165 -0.31987 0.069124 -0.21627 0.14638 -0.04219 -0.12283 -0.084405 0.17186 0.27554 0.06954 -0.094314 0.24977 0.41503 0.22993 -0.078799 0.061815 -0.3456 0.032278 0.0062517 0.070145 -0.14485 0.16392 0.060717 -0.099892 -0.06747 0.013072 0.27785 0.25822 0.16284 -0.14763 -0.1149 0.10436 0.31938 -0.26556 0.13868 -0.14827 0.048921 0.03239 -0.24192 -0.01802 0.3136 0.12209 0.45047 -0.27698 -0.014713 -0.33791 -0.0050258 0.1828 -0.19224 -0.21345 
in 0.0085237 0.37502 -0.1207 -0.25284 0.52305 0.32554 -0.12795 0.016179 0.3065 0.25186 -0.22798 0.075573 0.13748 0.3506 -0.25685 -0.21319 -0.0029775 0.078041 -0.016319 -0.16683 -0.016333 0.41009 0.33847 -0.14438 -0.16175 -0.35655 0.12865 -0.16027 -0.22298 0.30239 -0.17967 0.020702 -0.14791 -0.35058 -0.54343 -0.057452 -0.0025471 -0.19827 -0.080082 -0.15684 0.0010903 0.48555 0.12203 0.25791 0.37169 -0.094715 0.22766 0.00013246 -0.29713 0.34321 -0.47765 0.15343 -0.23924 0.26267 -0.086642 -0.13197 -0.12414 0.13017 0.36411 0.054736 -0.10353 0.28178 0.58931 0.35773 -0.14529 9.8501e-05 -0.45538 0.11227 -0.048705 0.088978 -0.213 0.2028 0.035638 -0.16254 -0.22001 -0.10495 0.31322 0.41383 0.22647 -0.14506 -0.11873 0.21242 0.44375 -0.21512 0.14714 -0.12032 0.032722 0.057316 -0.32666 -0.098112 0.4276 0.10581 0.63877 -0.32763 -0.013403 -0.50192 -0.024678 0.26048 -0.31562 -0.31949 
is 0.02044 0.00039778 -0.044823 -0.16769 0.32419 0.07076 -0.06175 0.04085 0.014419 0.16482 -0.070988 -0.088118 0.10066 0.013989 -0.15589 -0.033567 0.07894 0.091256 0.030269 -0.096267 -0.043749 0.23694 -0.019867 -0.013186 -0.060144 -0.087202 -0.0044666 -0.045432 -0.019242 0.14201 -0.1299 0.16476 -0.10457 -0.15828 -0.19581 -0.10587 -0.051501 -0.12512 0.014035 0.039545 -0.031714 0.15634 0.11253 0.11827 -0.017039 -0.137 0.17468 -0.056571 -0.09961 0.35321 -0.19676 0.15487 -0.086366 0.15522 -0.12949 0.018837 -0.10514 -0.1238 0.1062 0.028712 -0.034186 0.11337 0.17538 0.26014 -0.1056 -0.088167 -0.12994 0.10116 -0.073954 0.037518 -0.14802 0.049758 -0.014271 -0.05753 -0.25061 -0.20646 0.031246 0.18308 0.12495 0.080001 0.020292 0.14804 0.15056 0.093902 0.00079034 0.02815 -0.013319 0.061776 -0.08506 -0.09121 0.11476 -0.020453 0.32593 -0.036577 0.0095969 -0.1984 -0.028016 0.20513 -0.16345 -0.1937
$
# 用交互式方式预测文本
$ ./fastText-0.1.0/fasttext predict model_cooking.bin -
Which baking dish is best to bake a banana bread ?
__label__baking
Why not put knives in the dishwasher?
__label__food-safety
# 验证模型
$ ./fastText-0.1.0/fasttext test model_cooking.bin cooking.valid
N	3000
P@1	0.136
R@1	0.0587
Number of examples: 3000
$ ./fastText-0.1.0/fasttext test model_cooking.bin cooking.valid 5
N	3000
P@5	0.0677
R@5	0.146
Number of examples: 3000
$
# 输出文本的前5个标签
$ ./fastText-0.1.0/fasttext predict model_cooking.bin -
Why not put knives in the dishwasher?
__label__food-safety

$ ./fastText-0.1.0/fasttext predict model_cooking.bin - 5
Why not put knives in the dishwasher?
__label__food-safety __label__baking __label__bread __label__equipment __label__substitutions
# 以非交互式方式运行
$ cat test.txt
Which baking dish is best to bake a banana bread ?
Why not put knives in the dishwasher?
Why not put knives in the dishwasher?
$
$ ./fastText-0.1.0/fasttext predict model_cooking.bin test.txt 2
__label__bread __label__baking
__label__food-safety __label__baking
__label__food-safety __label__baking
$ 
$ ./fastText-0.1.0/fasttext print-sentence-vectors model_cooking.bin < test.txt
0.010838 0.32251 0.0018 -0.1393 0.28517 0.27495 -0.093648 -0.04564 0.26601 0.21855 -0.2035 0.11237 -0.017012 0.29593 -0.19623 -0.14209 0.0015843 0.083805 -0.075628 -0.17328 0.014877 0.28458 0.24118 -0.13538 -0.10069 -0.22493 0.08599 -0.21774 -0.16935 0.17449 -0.098764 -0.020882 -0.096189 -0.25014 -0.40864 0.0027028 -0.036393 -0.10199 -0.059659 -0.088981 -0.014554 0.41472 0.058719 0.25107 0.29597 -0.046373 0.12025 -0.057695 -0.21746 0.16724 -0.32039 0.080298 -0.24024 0.15626 -0.073412 -0.074393 -0.099186 0.12281 0.2428 0.098647 -0.093258 0.23056 0.42059 0.26877 -0.04747 0.033715 -0.29034 0.010309 0.0098754 0.042614 -0.15791 0.13986 0.041945 -0.04308 -0.081686 0.023805 0.2859 0.21611 0.1816 -0.11783 -0.11504 0.067771 0.30978 -0.21405 0.13006 -0.13892 0.055538 0.02473 -0.22285 -0.0029997 0.30365 0.15492 0.45209 -0.24925 0.028582 -0.29744 -0.028021 0.22202 -0.16367 -0.21138 
0.00145 0.2302 -0.054436 -0.1726 0.37969 0.21481 -0.087611 -0.012809 0.19813 0.23367 -0.16675 0.012125 0.090623 0.17926 -0.19973 -0.12572 0.027203 0.10004 -0.0030934 -0.12054 -0.034694 0.30578 0.18466 -0.095607 -0.11784 -0.21265 0.085819 -0.15313 -0.13374 0.23198 -0.15396 0.053445 -0.14311 -0.24253 -0.36151 -0.050234 -0.069581 -0.15213 -0.042819 -0.07861 -0.033867 0.35076 0.097889 0.17727 0.18545 -0.11779 0.19853 -0.037329 -0.19244 0.26736 -0.35118 0.16837 -0.18231 0.19112 -0.12766 -0.034289 -0.11247 0.055819 0.22002 0.058953 -0.10219 0.20163 0.37126 0.28786 -0.10206 -0.0093652 -0.30747 0.084114 -0.035765 0.061696 -0.19219 0.15265 0.039923 -0.1107 -0.19779 -0.1152 0.21593 0.27505 0.17622 -0.062677 -0.042941 0.13794 0.31159 -0.089261 0.066415 -0.074779 0.0031386 0.075679 -0.20471 -0.076418 0.29295 0.078605 0.46418 -0.21404 0.026947 -0.29467 -0.011417 0.2191 -0.25216 -0.23284 
0.00145 0.2302 -0.054436 -0.1726 0.37969 0.21481 -0.087611 -0.012809 0.19813 0.23367 -0.16675 0.012125 0.090623 0.17926 -0.19973 -0.12572 0.027203 0.10004 -0.0030934 -0.12054 -0.034694 0.30578 0.18466 -0.095607 -0.11784 -0.21265 0.085819 -0.15313 -0.13374 0.23198 -0.15396 0.053445 -0.14311 -0.24253 -0.36151 -0.050234 -0.069581 -0.15213 -0.042819 -0.07861 -0.033867 0.35076 0.097889 0.17727 0.18545 -0.11779 0.19853 -0.037329 -0.19244 0.26736 -0.35118 0.16837 -0.18231 0.19112 -0.12766 -0.034289 -0.11247 0.055819 0.22002 0.058953 -0.10219 0.20163 0.37126 0.28786 -0.10206 -0.0093652 -0.30747 0.084114 -0.035765 0.061696 -0.19219 0.15265 0.039923 -0.1107 -0.19779 -0.1152 0.21593 0.27505 0.17622 -0.062677 -0.042941 0.13794 0.31159 -0.089261 0.066415 -0.074779 0.0031386 0.075679 -0.20471 -0.076418 0.29295 0.078605 0.46418 -0.21404 0.026947 -0.29467 -0.011417 0.2191 -0.25216 -0.23284 
$

$
# 优化模型
$ cat cooking.stackexchange.txt | sed -e "s/\([.\!?,'/()]\)/ \1 /g" | tr "[:upper:]" "[:lower:]" > cooking.preprocessed.txt
$ head -n 12404 cooking.preprocessed.txt > cooking.train
$ tail -n 3000 cooking.preprocessed.txt > cooking.valid
$ ./fastText-0.1.0/fasttext supervised -input cooking.train -output model_cooking
Read 0M words
Number of words:  8952
Number of labels: 735
Progress: 100.0%  words/sec/thread: 52856  lr: 0.000000  loss: 10.107295  eta: 0h0m
$ ./fastText-0.1.0/fasttext test model_cooking.bin cooking.valid
N	3000
P@1	0.169
R@1	0.0732
Number of examples: 3000
$ ./fastText-0.1.0/fasttext supervised -input cooking.train -output model_cooking -epoch 25
$ ./fastText-0.1.0/fasttext supervised -input cooking.train -output model_cooking -lr 1.0
$ ./fastText-0.1.0/fasttext supervised -input cooking.train -output model_cooking -lr 1.0 -epoch 25
$ ./fastText-0.1.0/fasttext supervised -input cooking.train -output model_cooking -lr 1.0 -epoch 25 -wordNgrams 2
$ ./fastText-0.1.0/fasttext supervised -input cooking.train -output model_cooking -lr 1.0 -epoch 25 -wordNgrams 2 -bucket 200000 -dim 50 -loss hs
$

```

* [参考1](https://fasttext.cc/)

* [参考2](https://github.com/facebookresearch/fastText)